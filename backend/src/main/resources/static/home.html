<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Uploader</title>
    <style>

        body {
          font-family: Arial, sans-serif;
          background-color: #f4f4f9;
          display: flex;
          flex-direction: column;
          align-items: center;
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      header {
          width: 100%;
          background-color: #005149;
          color: white;
          padding: 10px 0;
          display: flex;
          justify-content: space-between;
          align-items: center;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      header h1 {
          margin: 0;
          padding: 0 20px;
          font-size: 2em;
          color: white;
      }

      .nav-button,.dropdown-button {
          margin: 0 20px;
          padding: 10px 20px;
          font-size: 20px;
          background-color:#f5b501;
          color: #091521;
          border: 2px solid #f5b501;
          border-radius: 20px;
          cursor: pointer;
          transition: background-color 0.3s, color 0.3s, border 0.3s;
          position: relative;
      }

      .nav-button:hover,.dropdown-button:hover {
          background-color: #3a7a74;
          color: white;
          border: 2px solid #3a7a74;
      }

      /* Dropdown Menu Styles */
.dropdown-menu {
display: none; /* Hidden by default */
position: absolute;
background-color: #dddcda;
border-radius: 8px;
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
z-index: 1000;
width: 200px;
}

.dropdown-menu.show {
display: block; /* Show when toggled */
}

.dropdown-menu a {
display: block;
padding: 10px;
color: #091521;
text-decoration: none;
font-size: 16px;
}

.dropdown-menu a:hover {
background-color: #3a7a74;
color: white;
}


      .container {
          background-color: white;
          padding: 40px;
          border-radius: 8px;
          box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
          width: 100%;
          text-align: center;
          position: relative;
          flex-grow: 1;
          display: flex;
          flex-direction: column;
          margin-top: 64px;
          margin-bottom: 50px;
          align-items: center;
          min-height: calc(100vh - 72px);
      }

      .inner-container {
          padding: 10px;
          border: 2px dashed #3a7a74;
          border-radius: 10px;
          background-color: #cfd0cf;
          margin-top: 40px;
      }

      .output-container{
          padding: 10px;
          border: 2px dashed #3a7a74;
          border-radius: 10px;
          background-color: #cfd0cf;
          margin-top: 40px;
      }

      .button-group {
          position: absolute;
          top: 5px;
          right: 20px;
          display: flex;
          gap: 5px;
          margin-top: 0px;
          margin-bottom: 40px;
      }

      .button-group button {
          padding: 10px 15px; /* Adjusted padding */
          font-size: 14px; /* Adjusted font size */
      }

      .heading {
          margin-top: 0px;
          color: #3a7a74;
          padding: 0px 20px; /* Adjusts padding: 10px top/bottom, 20px left/right */
          padding-bottom: 10px;
          border: 2px transparent; /* Adds a border around the box */
          border-radius: 10px; /* Rounds the corners of the box */
          background-color: transparent; /* Adds a light background color */
          text-align: center; /* Centers the text */
          font-family: 'Arial', sans-serif; /* Sets the font */
          font-size: 24px; /* Sets the font size */
      }

      .download-button {
          background-color: #d3d3d3;
          color: white;
          border: none;
          padding: 15px 30px;
          border-radius: 5px;
          cursor: not-allowed;
          font-size: 16px;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          transition: background-color 0.3s, box-shadow 0.3s;
      }

      .download-button.enabled {
          background-color: #3a7a74;
          cursor: pointer;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .download-button.enabled:hover {
          background-color: #da9620;
      }

      .submit-button-group {
          display: flex;
          justify-content: center;
          margin-top: 20px;
      }

      button.submit-button {
          background-color: #f5b501;
          color: black;
          border: none;
          padding: 15px 30px;
          border-radius: 20px;
          cursor: pointer;
          font-size: 16px;
      }

      button.submit-button:hover {
          background-color: #3a7a74;
      }

      h1 {
          color: #333;
          margin-bottom: 20px;
          font-size: 2em;
          align-items: center;
      }

      input[type="file"],
      select {
          margin: 10px;
          padding: 10px;
          border: 2px solid #ddd;
          border-radius: 5px;
          width: calc(100% - 40px); /* Adjust as needed for padding/margins */
          max-width: 400px; /* Ensure the maximum width is consistent */
          background-color: #f9f9f9;
          font-size: 16px;
          box-sizing: border-box; /* Ensures padding is included in the width */
      }

      table {
          margin: 20px auto;
          border-collapse: collapse;
          width: 80%;
          max-width: 600px;
      }

      table, th, td {
          border: 1px solid #ddd;
      }

      th, td {
          padding: 10px;
          text-align: left;
      }

      .overall-percentage {
          font-size: 1.5em;
          color: #005149;
          margin-top: 40px;
          font-weight: bold;
      }

      .field-group {
          margin: 20px 0;
          display: flex;
          align-items: center;
          justify-content: center;
      }

      .field-group label {
          font-size: 16px;
          margin-right: 10px;
      }

      .field-group h3, .jd-option h3 {
          margin: 0 10px 0 0;
          white-space: nowrap; /* Prevents text from wrapping */
      }

      .jd-options {
          display: flex;
          /* flex-direction: column; */
          width: auto;
          gap: 20px;
      }

      .jd-option {
          display: flex;
          align-items: center;
          width: 100%;
          max-width: 400px;
      }

      .jd-option label {
          margin-left: 10px;
      }

      #jdSelect,
      #jdFileInput {
          width: calc(100% - 40px); /* Adjust as needed for padding/margins */
           /* Ensure the maximum width is consistent */
          padding: 10px;
          border: 2px solid #ddd;
          border-radius: 5px;
          background-color: #f9f9f9;
          font-size: 16px;
          box-sizing: border-box; /* Ensures padding is included in the width */
      }
      #jdSelect {
  width: 100%;
  max-width: 400px; /* Adjust as needed */
  height: 48.5px;
}

      .hidden {
          display: none;
      }

      .modal {
          display: none; /* Hidden by default */
          position: fixed; /* Stay in place */
          z-index: 2; /* Sit on top */
          padding-top: 100px; /* Location of the box */
          left: 0;
          top: 0;
          width: 100%; /* Full width */
          height: 100%; /* Full height */
          overflow: auto; /* Enable scroll if needed */
          background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
      }

      .modal-content {
          background-color: #fefefe;
          margin: auto;
          padding: 20px;
          border: 1px solid #888;
          width: 80%;
          max-width: 500px;
          text-align: center;
          border-radius: 10px;
      }

      .close {
          color: #aaa;
          float: right;
          font-size: 28px;
          font-weight: bold;
      }

      .close:hover,
      .close:focus {
          color: black;
          text-decoration: none;
          cursor: pointer;
      }

      #modalEmailInput,
      #submitEmailButton {
          width: calc(100% - 40px); /* Adjusts width to full within padding */
          padding: 10px;
          box-sizing: border-box;
          font-size: 16px;
      }

      #modalEmailInput {
          margin-bottom: 20px;
          border: 1px solid #ccc;
          border-radius: 5px;
      }

      #submitEmailButton {
          background-color: #005149;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
      }

      #submitEmailButton:hover {
          background-color: #3a7a74;
      }

      .loader {

          display: inline-block;
          border: 4px solid #f3f3f3; /* Reduce border size */
          border-top: 4px solid #005149; /* Reduce border-top size */
          border-radius: 50%;
          width: 30px; /* Reduce width */
          height: 30px; /* Reduce height */
          animation: spin 2s linear infinite;
          margin-bottom: 10px;

      }

      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }


      /* Hide the loader by default */
      .loader.hidden {
      display: none;
      }


      .message-modal {
  display: none; /* Initially hide the modal */
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
}

.message-modal-content {
  background-color: rgb(236, 235, 230); /* Modal content background color */
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 10px;
  padding-right: 20px;
  color: #091521;
  border-radius: 10px;
  border: 1px solid #888;
  font-size: 16px;
  max-width: 90%;
  text-align: center;
  white-space: nowrap;
  /* animation: fadeOut 7s forwards; */
}

@keyframes fadeOut {
  0% {
      opacity: 1;
  }
  100% {
      opacity: 0;
      visibility: hidden;
  }
}
      .details-button {
          background-color: #f5f5f5;
          color: black;
          border: 10px;
          padding: 10px 20px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 14px;
          margin: 4px 2px;
          cursor: pointer;
          border-radius: 8px;
      }

      .details-button:hover {
          background-color: #2883a4;
      }

      footer {
            background: white;
            text-align: center;
            padding: 10px 20px;
            width: 100%;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
            position: fixed;
            bottom: 0;
            left: 0;
        }

    </style>
</head>

<body>
<div id="header"></div>

<div class="container">

    <div class="button-group">
        <button type="button" id="downloadFeedbackButton" class="download-button" disabled>Download Feedback</button>
        <button type="button" id="downloadReportButton" class="download-button" disabled>Download Report</button>
        <button type="button" id="sendEmailButton" class="download-button" disabled>Send Feedback to Candidate</button>
    </div>

    <div class="loader"></div>


    <div class="inner-container">
        <div class="heading">
            <h1>Match your Resume</h1>
        </div>

        <form id="uploadForm" enctype="multipart/form-data">
            <div class="field-group">
                <label for="fileInput"><h3>Select Your Resume:</h3></label>
                <input type="file" name="file" id="fileInput" accept=".pdf,.doc,.docx,.jpg,.png" required>
            </div>

            <div class="jd-options">
                <div class="jd-option">
                    <input type="radio" id="selectJdRadio" name="jdOption" value="selectJd" checked>
                    <label for="selectJdRadio"><h3>Select an Existing JD:</h3></label>
                    <select id="jdSelect" name="jdId">
                        <option value="" disabled selected>Select Job Description</option>
                    </select>
                </div>

                <div class="jd-option">
                    <input type="radio" id="uploadJdRadio" name="jdOption" value="uploadJd">
                    <label for="uploadJdRadio"><h3>Upload a New JD:</h3></label>
                    <input type="file" name="jdFile" id="jdFileInput" accept=".pdf,.doc,.docx,.jpg,.png" disabled>
                </div>
            </div>


            <div class="submit-button-group">
                <button type="submit" class="submit-button">Submit</button>
            </div>

            <!-- Your existing form elements -->

            <!-- Email Input Modal -->
            <div id="emailModal" class="modal hidden">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <p>Unable to fetch email id of candidate from resume. Kindly enter the candidate email id manually</p>
                    <label for="modalEmailInput">Enter candidate email address:</label>
                    <input type="email" id="modalEmailInput" placeholder="Enter email address">
                    <button id="submitEmailButton">Submit</button>
                </div>
            </div>

            <!-- Message modal -->

            <div id="myModal" class="message-modal">
                <div class="message-modal-content">

                    <p id="modalMessage"></p>
                </div>
                <span class="close">&times;</span>
            </div>

        </form>
    </div>


    <div id="result" class="output-container" style="display: none;">
        <div id="overallPercentage" class="overall-percentage"></div>
        <h2>Mandatory Skills</h2>
        <table id="mandatorySkillsTable">
            <thead>
            <tr>
                <th>Mandatory Skill</th>
                <th>Candidate Experience</th>
                <th>Required Experience (years)</th>
                <th>Percentage Match</th>
                <th>Details</th>
                <th>Matched Subskills</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>


        <h2>Other Tech Experience Of Candidate</h2>
        <table id="itSkillsTable">
            <thead>
            <tr>
                <th>Skill</th>
                <th>Candidate Experience</th>
                <th>Details</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="footer"></div>

<script>

     fetch('header.html')
         .then(response => response.text())
         .then(data => {
             document.getElementById('header').innerHTML = data;
         });

     fetch('footer.html')
         .then(response => response.text())
         .then(data => {
             document.getElementById('footer').innerHTML = data;
         });



    document.addEventListener('DOMContentLoaded', function() {
        console.log("DOM fully loaded and parsed");

        const token = localStorage.getItem('accessToken');
        if (!token) {
            showModal("You have not yet logged in. kindly login first");
            return;
        }

    // Function to show the loader
    function showLoader() {
        const loader = document.querySelector('.loader');
        loader.style.display = 'block';
    }

    // Function to hide the loader
    function hideLoader() {
        const loader = document.querySelector('.loader');
        loader.style.display = 'none';
    }

        fetch('http://43.205.154.85:8080/jd/getIds', {
            headers: {
                "Authorization": `Bearer ${token}`
            }
        })
            .then(response => {
                console.log("Fetching Job Descriptions...");

                showLoader(); // Show loader before API call
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                hideLoader();
                const jdSelect = document.getElementById('jdSelect');
                console.log("Job Descriptions Data: ", data);
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = item.title;
                    jdSelect.appendChild(option);
                });
            })
            .catch(error => {
            hideLoader(); // Hide loader if there's an error
            console.error('Error fetching job descriptions:', error);
        });
        const selectJdRadio = document.getElementById('selectJdRadio');
        const uploadJdRadio = document.getElementById('uploadJdRadio');
        const jdSelect = document.getElementById('jdSelect');
        const jdFileInput = document.getElementById('jdFileInput');

        selectJdRadio.addEventListener('change', function() {
            jdSelect.disabled = !this.checked;
            jdFileInput.disabled = this.checked;
        });

        uploadJdRadio.addEventListener('change', function() {
            jdSelect.disabled = this.checked;
            jdFileInput.disabled = !this.checked;
        });
    });



    document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM fully loaded and parsed");

    // Function to show the loader
    function showLoader() {
        const loader = document.querySelector('.loader');
        loader.style.display = 'block';
    }

    // Function to hide the loader
    function hideLoader() {
        const loader = document.querySelector('.loader');
        loader.style.display = 'none';
    }
    document.getElementById('uploadForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const selectedId = document.getElementById('jdSelect').value;
        const jdFile = document.getElementById('jdFileInput').
        files[0];
        const formData = new FormData();
        formData.append('file', document.getElementById('fileInput').files[0]);

        if (document.getElementById('selectJdRadio').checked) {
            formData.append('jdId', selectedId);
        } else if (document.getElementById('uploadJdRadio').checked && jdFile) {
            formData.append('jdFile', jdFile);
        } else {
            showModal('Please select or upload a JD.');
            return;
        }

        console.log("Selected Job Description ID: ", selectedId);
        console.log("Form Data: ", formData);

        // Show the loader
        showLoader();
        const token = localStorage.getItem('accessToken');
        if (!token) {
            console.error("No token found. Please log in.");
            return;
        }

        fetch(`http://43.205.154.85:8080/upload`, {
            method: 'POST',
            headers: {

                "Authorization": `Bearer ${token}`
            },
            body: formData
        })
        .then(response => {
            hideLoader();
            console.log("Uploading file...");
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            hideLoader();
            console.log("Received data: ", data);
            const itSkillsMap = data.itSkills || {};
            const mandatorySkillsMap = data.mandatorySkills || {};
            const overallPercentage = mandatorySkillsMap.overallPercentage || 0;
            delete mandatorySkillsMap.overallPercentage;
            console.log("IT Skills Map: ", itSkillsMap);
            console.log("Mandatory Skills Map: ", mandatorySkillsMap);
            console.log("Overall Percentage: ", overallPercentage);



            // Display overall percentage
            const overallPercentageDiv = document.getElementById('overallPercentage');
            overallPercentageDiv.textContent = `Overall Percentage: ${overallPercentage.toFixed(2)}%`;

            // Handle itSkills
            // Handle itSkills
            const itSkillsTableBody = document.getElementById('itSkillsTable').querySelector('tbody');
            itSkillsTableBody.innerHTML = '';
            Object.entries(itSkillsMap).forEach(([skill, skillInfo]) => {
                const row = document.createElement('tr');

                const skillCell = document.createElement('td');
                skillCell.textContent = skill;
                row.appendChild(skillCell);

                const durationCell = document.createElement('td');
                durationCell.textContent = skillInfo.totalDuration;
                row.appendChild(durationCell);

                const detailsCell = document.createElement('td');
                const detailsButton = document.createElement('button');
                detailsButton.className = 'details-button';
                detailsButton.textContent = 'Show Details';
                detailsCell.appendChild(detailsButton);

                const detailsList = document.createElement('ul');
                detailsList.style.display = 'none';

                if (Array.isArray(skillInfo.details)) {
                    skillInfo.details.forEach(detail => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `From ${detail.startDate} to ${detail.endDate}: ${detail.durationInMonths} months`;
                        detailsList.appendChild(listItem);
                    });
                } else {
                    const listItem = document.createElement('li');
                    listItem.textContent = 'Details not available';
                    detailsList.appendChild(listItem);
                }

                detailsCell.appendChild(detailsList);
                row.appendChild(detailsCell);

                detailsButton.addEventListener('click', function() {
                    const isVisible = detailsList.style.display === 'block';
                    detailsList.style.display = isVisible ? 'none' : 'block';
                    detailsButton.textContent = isVisible ? 'Show Details' : 'Hide Details';
                });

                itSkillsTableBody.appendChild(row);
            });


            // Handle mandatorySkills
            // Handle mandatorySkills
            const mandatorySkillsTableBody = document.getElementById('mandatorySkillsTable').querySelector('tbody');
            mandatorySkillsTableBody.innerHTML = '';
            Object.entries(mandatorySkillsMap).forEach(([skill, skillInfo]) => {
                const row = document.createElement('tr');

                const skillCell = document.createElement('td');
                skillCell.textContent = skill;
                row.appendChild(skillCell);

                const durationCell = document.createElement('td');
                durationCell.textContent = skillInfo.totalDuration;
                row.appendChild(durationCell);

                const requiredExperienceCell = document.createElement('td');
                requiredExperienceCell.textContent = skillInfo.requiredExperience;
                row.appendChild(requiredExperienceCell);

                const percentageCell = document.createElement('td');
                percentageCell.textContent = skillInfo.percentage !== undefined ? `${skillInfo.percentage.toFixed(2)}%` : 'N/A';
                row.appendChild(percentageCell);

                const detailsCell = document.createElement('td');
                const detailsButton = document.createElement('button');
                detailsButton.className = 'details-button';
                detailsButton.textContent = 'Show Details';
                detailsCell.appendChild(detailsButton);

                const detailsList = document.createElement('ul');
                detailsList.style.display = 'none';

                if (Array.isArray(skillInfo.details)) {
                    skillInfo.details.forEach(detail => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `From ${detail.startDate} to ${detail.endDate}: ${detail.durationInMonths} months`;
                        detailsList.appendChild(listItem);
                    });
                } else {
                    const listItem = document.createElement('li');
                    listItem.textContent = 'Details not available';
                    detailsList.appendChild(listItem);
                }

                detailsCell.appendChild(detailsList);
                row.appendChild(detailsCell);

                detailsButton.addEventListener('click', function() {
                    const isVisible = detailsList.style.display === 'block';
                    detailsList.style.display = isVisible ? 'none' : 'block';
                    detailsButton.textContent = isVisible ? 'Show Details' : 'Hide Details';
                });

                const subskillsCell = document.createElement('td');
                const subskillsList = document.createElement('ul');

                if (Array.isArray(skillInfo.matchedSubSkills)) {
                    skillInfo.matchedSubSkills.forEach(subskill => {
                        const listItem = document.createElement('li');
                        listItem.textContent = subskill;
                        subskillsList.appendChild(listItem);
                    });
                } else {
                    const listItem = document.createElement('li');
                    listItem.textContent = 'No subskills';
                    subskillsList.appendChild(listItem);
                }

                subskillsCell.appendChild(subskillsList);
                row.appendChild(subskillsCell);

                mandatorySkillsTableBody.appendChild(row);
            });


            // Display the result section
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            enableDownloadButton();

            document.getElementById('downloadReportButton').classList.add('enabled');
            document.getElementById('downloadReportButton').disabled = false;
        })
        .catch(error => {
            hideLoader();
            showModal('Token expired ! Login again');
        });


        function showModal(message) {
            const modal = document.getElementById('myModal');
            const modalMessage = document.getElementById('modalMessage');
            modalMessage.textContent = message;
            modal.style.display = 'flex';

            // Function to hide the modal after 3 seconds
            function hideModal() {
                modal.style.display = 'none';
            }

            // Set timeout to hide modal after 3 seconds (adjust as needed)
            setTimeout(hideModal, 6000); // 3000 milliseconds = 3 seconds

            // Close button functionality
            const closeButton = modal.querySelector('.close');
            closeButton.addEventListener('click', hideModal);

            // Click outside modal to close functionality
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    hideModal();
                }
            });
        }



    });
})

    document.getElementById('downloadReportButton').addEventListener('click', function() {
    const fileInput = document.getElementById('fileInput');
    const jdFileInput = document.getElementById('jdFileInput');
    const selectedId = document.getElementById('jdSelect').value;

    const token = localStorage.getItem('accessToken');
        if (!token) {
            showModal("You have not yet logged in. kindly login first");
            return;
        }

    if (!fileInput || !fileInput.files.length) {
        console.error('Resume file input is missing or no file selected.');
        return;
    }

    const formData = new FormData();
    formData.append('file', fileInput.files[0]);

    if (jdFileInput && jdFileInput.files.length > 0) {
        formData.append('jdFile', jdFileInput.files[0]);
    } else if (selectedId) {
        formData.append('jdId', selectedId);
    } else {
        console.error('Neither JD file nor JD ID provided.');
        return;
    }

    fetch('http://43.205.154.85:8080/downloadMatchReportPdf', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`
        },
        body: formData
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.blob();
    })
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = 'report.pdf';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
    })
    .catch(error => {
        console.error('There has been a problem with your fetch operation:', error);
    });
});
   // Add event listener for "Download Feedback" button


document.getElementById('downloadFeedbackButton').addEventListener('click', function(event) {
    event.preventDefault(); // Prevent default action

    // Directly proceed with downloading feedback
    downloadFeedback();
});

// function enableDownloadButton() {
//     const downloadButton = document.getElementById('downloadFeedbackButton');
//     downloadButton.disabled = false;

// }


function enableDownloadButton() {
        const downloadButton = document.getElementById('downloadFeedbackButton');
        downloadButton.classList.add('enabled');
        downloadButton.disabled = false;

        const sendEmailButton = document.getElementById('sendEmailButton');
        sendEmailButton.classList.add('enabled');
        sendEmailButton.disabled = false;
    }




    function downloadFeedback() {
    const selectedId = document.getElementById('jdSelect').value;
    const formData = new FormData();
    formData.append('file', document.getElementById('fileInput').files[0]);

    const token = localStorage.getItem('accessToken');
        if (!token) {
            showModal("You have not yet logged in. kindly login first");
            return;
        }

    const jdFile = document.getElementById('jdFileInput').files[0];
    if (document.getElementById('selectJdRadio').checked) {
        formData.append('jdId', selectedId);
    } else if (document.getElementById('uploadJdRadio').checked && jdFile) {
        formData.append('jdFile', jdFile);
    } else {
        showModal('Please select or upload a JD.');
        return;
    }

    fetch('http://43.205.154.85:8080/generateReport', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`
        },
        body: formData
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.blob();
    })
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = 'feedback.pdf';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
    })
    .catch(error => {
        console.error('Error:', error);
        showModal('Error occurred while downloading feedback. Please try again.');
    });
}


function showModal(message) {
        const modal = document.getElementById("myModal");
        const modalMessage = document.getElementById("modalMessage");
        modalMessage.textContent = message;
        modal.style.display = "flex";

        const closeButton = document.getElementsByClassName("close")[0];
        closeButton.onclick = function() {
            modal.style.display = "none";
        };

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        };
    }


document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM fully loaded and parsed");

    //Function to show the loader
    function showLoader() {
        const loader = document.querySelector('.loader');
        loader.style.display = 'block';
    }

    // Function to hide the loader
    function hideLoader() {
        const loader = document.querySelector('.loader');
        loader.style.display = 'none';
    }

    document.getElementById('sendEmailButton').addEventListener('click', function() {
        sendEmail();

    });

    function sendEmail(email = '') {
    const fileInput = document.getElementById('fileInput');
    const jdFileInput = document.getElementById('jdFileInput');
    const selectedId = document.getElementById('jdSelect').value;

    if (!fileInput || !fileInput.files.length) {
        console.error('Resume file input is missing or no file selected.');
        return;
    }

    const formData = new FormData();
    formData.append('file', fileInput.files[0]);

    if (jdFileInput && jdFileInput.files.length > 0) {
        formData.append('jdFile', jdFileInput.files[0]);
    } else if (selectedId) {
        formData.append('jdId', selectedId);
    } else {
        console.error('Neither JD file nor JD ID provided.');
        return;
    }

    if (email) {
        formData.append('email', email);
    }

    const token = localStorage.getItem('accessToken');
        if (!token) {
            showModal("You have not yet logged in. kindly login first");
            return;
        }



    // Show the loader
    showLoader();

    fetch('http://43.205.154.85:8080/sendReportEmail', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`
        },
        body: formData
    })
    .then(response => {
        hideLoader();
        if (response.status === 400) {
            return response.text().then(text => {
                throw new Error(text);
            });
        }
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.text();
    })
    .then(data => {
        hideLoader();
        showModal('Resume report has been successfully mail to the client           ');
    })
    .catch(error => {
        hideLoader();
        if (error.message.includes("Unable to extract email from the resume. Please provide an email address.")) {
            openEmailModal();
        } else {
            console.error('There has been a problem with your fetch operation:', error);
            showModal('Error occurred while sending email. Please try again.');
        }
    });
}

function openEmailModal() {
    const emailModal = document.getElementById('emailModal');
    const closeButton = document.querySelector('.close');
    const submitEmailButton = document.getElementById('submitEmailButton');

    emailModal.classList.remove('hidden');
    emailModal.style.display = "block";

    closeButton.onclick = function() {
        emailModal.classList.add('hidden');
        emailModal.style.display = "none";
    }

    submitEmailButton.onclick = function() {
        const email = document.getElementById('modalEmailInput').value;
        if (validateEmail(email)) {
            emailModal.classList.add('hidden');
            emailModal.style.display = "none";
            sendEmail(email);
        } else {
            showModal('Please enter a valid email address.');
        }
    }

    window.onclick = function(event) {
        if (event.target == emailModal) {
            emailModal.classList.add('hidden');
            emailModal.style.display = "none";
        }
    }
}

function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
}

        function showModal(message) {
            const modal = document.getElementById('myModal');
            const modalMessage = document.getElementById('modalMessage');
            modalMessage.textContent = message;
            modal.style.display = 'flex';

            // Function to hide the modal after 3 seconds
            function hideModal() {
                modal.style.display = 'none';
            }

            // Set timeout to hide modal after 3 seconds (adjust as needed)
            setTimeout(hideModal, 6000); // 3000 milliseconds = 3 seconds

            // Close button functionality
            const closeButton = modal.querySelector('.close');
            closeButton.addEventListener('click', hideModal);

            // Click outside modal to close functionality
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    hideModal();
                }
            });
        }

})

</script>
</body>
</html>

